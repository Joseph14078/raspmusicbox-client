function rjust(e,t,o){return e<=t.length?t:rjust(e,o+t,o)}function percentageInRange(e,t,o){return(e-t)/(o-t)}function assignActions(){$("#card_test_textbox").keypress(function(e){13==e.which&&cardServerConnect()}),$("#button_play_pause").click(function(){websocket.send("0")}),$("#button_stop").click(function(){websocket.send("1")}),$("#button_prev").click(function(){websocket.send("2")}),$("#button_next").click(function(){websocket.send("3")}),$("#slider_volume").mousedown(function(e){websocket.send("4"+(1-e.offsetY/$("#slider_volume").height()).toString())}),$("#progress-bar").mousedown(function(e){websocket.send("6"+(e.offsetX/$("#progress-bar").width()*data.lengths[data.index]).toString())}),$("#icon_volume").click(function(){websocket.send("7")}),$("#button_mode").click(function(){websocket.send("8")}),$(window).resize(columnLeftSize),columnLeftSize()}function columnLeftSize(){$("#column-left").width($(window).width()-$("#column-right").width()),$("#border-shadow-1").css("right",$("#column-right").width())}function cardServerConnect(){server=$("#card_test_textbox").val(),cardServerHide(),doConnect()}function doConnect(){localStorage.server=server;try{websocket=new WebSocket(-1===server.indexOf(":")?"ws://"+server+":"+port_default:"ws://"+server)}catch(e){cardServerShow()}websocket.onopen=function(e){onOpen(e)},websocket.onclose=function(e){onClose(e)},websocket.onmessage=function(e){onMessage(e)},websocket.onerror=function(e){onError(e)}}function onOpen(){debug&&console.log("connected to "+server),screenLoadHide()}function onClose(){debug&&console.log("disconnected"),cardServerShow(),screenLoadShow()}function screenLoadShow(){$("#load-bg").hasClass("element_fade_out")&&($("#load-bg").removeClass("element_fade_out"),$("#load-bg").addClass("element_fade_in"))}function screenLoadHide(){$("#load-bg").removeClass("element_fade_in"),$("#load-bg").addClass("element_fade_out")}function cardServerShow(){$("#card_test_textbox").val(server).focus(),$("#card_test").removeClass("element_fade_out").addClass("element_fade_in")}function cardServerHide(){$("#card_test").removeClass("element_fade_in").addClass("element_fade_out"),$("#card_test_textbox").blur()}function onError(e){debug&&console.log("error: "+e.data),websocket.close()}function onMessage(e){switch(debug&&console.log(e.data),mode=e.data.substring(0,1),data=$.extend(data,JSON.parse(e.data.substring(1,e.data.length))),mode){case"0":setPlaylist(),setIndex(),setPlaying(),setProgress(),setVolume(),setMute(),setMode(),setColorTime(),setColorCycle();break;case"1":debug&&console.log("Reserved for files, not implemented.");break;case"2":setPlaying();break;case"3":setIndex(),setColorCycle();break;case"4":debug&&console.log("Reserved for lengths, not implemented.");break;case"5":setProgress(),setColorTime();break;case"6":setVolume();break;case"7":setMute();break;case"8":setMode()}}function setColorCycle(){colorCycle.changeCycle(data.cycles[data.cycles_index[data.index]],data.lengths[data.index])}function setColorTime(){colorCycle.time=data.time}function setPlaylist(){for(var e="",t=0;t<data.files.length;t++)e+="<tr id='playlist-option-"+t+"' class='playlist-option'><td>"+data.files[t]+"</td><td>"+Math.floor(data.lengths[t]/60).toString()+":"+rjust(2,Math.round(data.lengths[t]%60).toString(),"0")+"</td></tr>";$("#playlist").html(e),$(".playlist-option").click(function(){var e=$(this).attr("id").replace("playlist-option-","");websocket.send("5"+e)})}function setPlaying(){$("#button_play_pause").text(data.playing?"pause":"play_arrow")}function setIndex(){$("#song-title").text(data.files[data.index]),null!==data.index_prev&&$("#playlist-option-"+data.index_prev).removeClass("playlist-option-active"),$("#playlist-option-"+data.index).addClass("playlist-option-active"),data.index_prev=data.index}function setProgress(){$("#progress-bar-fill").css("width",Math.min(data.time/data.lengths[data.index]*100,100).toString()+"%")}function setVolume(){$("#slider_volume_set").css("height",(100*data.volume).toString()+"%")}function setMute(){$("#icon_volume").text(data.mute?"volume_mute":"volume_up")}function setMode(){var e="arrow_forward";switch(data.mode){case 1:e="repeat";break;case 2:e="repeat_one";break;case 3:e="shuffle"}$("#button_mode").text(e)}function flyoutInit(){$(document).click(function(e){if(debug&&console.log(e),e.target.classList.contains("flyout"))$("#"+e.target.id).addClass("flyout_open").removeClass("flyout_default"),$("#"+e.target.id+" .flyout_contents").addClass("flyout_contents_open").removeClass("flyout_contents_default"),$("#"+e.target.id+" .flyout_container").addClass("flyout_container_open").removeClass("flyout_container_default");else if(!e.target.classList.contains("flyout_object"))for(var t=0;t<$(".flyout").length;t++)$($(".flyout")[t]).addClass("flyout_default").removeClass("flyout_open"),$("#"+$(".flyout")[t].id+" .flyout_contents").addClass("flyout_contents_default").removeClass("flyout_contents_open"),$("#"+$(".flyout")[t].id+" .flyout_container").addClass("flyout_container_default").removeClass("flyout_container_open")})}var server=localStorage.server||window.location.hostname,websocket,data={index_prev:void 0},debug=!1,port_default="8000";$(document).ready(function(){var e=document.getElementById("list-overflow");Ps.initialize(e),doConnect(),assignActions(),flyoutInit(),colorCycle.init()});var colorCycle={element:void 0,refreshRate:250,fadeOut:2,fadeOutOffset:1,time:0,queue:[],timeTotal:void 0,init:function(){this.element=document.getElementById("column-left"),$(this.element).css("transition","background-color "+(this.refreshRate/1e3).toString()+"s linear"),setInterval(function(){colorCycle.threadMain()},this.refreshRate)},changeCycle:function(e,t){this.queue=[];for(var o=e.split("\n"),n=0;n<o.length;n++){var s=o[n].split(",");this.queue.push({color:s.slice(0,3).map(function(e){return parseInt(e)}),time:parseFloat(s[3])})}this.timeTotal=t},threadMain:function(){if(0!==this.queue.length&&void 0!==this.timeTotal){for(var e=0,t=0;this.time>=t;)e%=this.queue.length,t+=this.queue[e].time,e++;e--;for(var o,n=percentageInRange(this.time,t-this.queue[e].time,t),s=[],a=0;3>a;a++){o=0>=e?this.time>=this.queue[0].time?this.queue[this.queue.length-1].color[a]:0:this.queue[e-1].color[a];var i=this.queue[e].color[a],l=n*(i-o)+o,r=this.timeTotal-this.fadeOutOffset,c=r-this.fadeOut;this.time>=c&&(l*=1-Math.min(Math.max(percentageInRange(this.time,c,r),0),1)),s.push(Math.round(l))}this.element.style.backgroundColor="rgb("+s.toString()+")"}}};